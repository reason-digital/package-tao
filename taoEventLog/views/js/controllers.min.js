define("taoEventLog/controller/routes",[],function(){"use strict";return{TaoEventLog:{actions:{index:"controller/TaoEventLog/show"}}}}),define("tpl!taoEventLog/controller/TaoEventLog/show/layout",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='\n                \n                    <div class="grid-row">\n                        <div class="col-12">\n                            <strong>',(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</strong>\n                        </div>\n                    </div>\n                    <div class="grid-row">\n                        <div class="col-10 desc">\n                            <span class="',(helper=helpers.key)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.key,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"></span>\n                        </div>\n                    </div>\n\n                '}this.compilerInfo=[4,">= 1.0.0"],
helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this;return buffer+='<div class="log">\n    <div class="grid-row">\n        <div class="col-7">\n            <section class="log-browser">\n                <header>\n                    <h2>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},
helper?helper.call(depth0,"Log watcher",options):helperMissing.call(depth0,"__","Log watcher",options)))+'</h2>\n                    <div class="header-buttons">\n                        <button class="btn-info export js-export"><span class="icon-export"></span>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},
helper?helper.call(depth0,"Export log entries",options):helperMissing.call(depth0,"__","Export log entries",options)))+'</button>\n                    </div>\n                </header>\n                <div class="log-table-filters"></div>\n                <div class="log-table"></div>\n            </section>\n        </div>\n        <div class="col-5">\n            <section class="event-viewer hidden">\n                <div class="grid-row">\n                    <div class="col-10">\n                        <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},
helper?helper.call(depth0,"Event",options):helperMissing.call(depth0,"__","Event",options)))+' #<span class="id"></span></h3>\n                    </div>\n                </div>\n\n                ',stack1=helpers.each.call(depth0,depth0&&depth0.dataTypes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n            </section>\n        </div>\n    </div>\n</div>\n"})}),define("tpl!taoEventLog/components/export/templates/layout",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],
helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<div class="mp-export-modal">\n    <h1>',(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1="function"==typeof helper?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</h1>\n    <form class="grid-row js-export-form">\n        <div class="col-12">\n            <h2>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},
helper?helper.call(depth0,"CSV Options",options):helperMissing.call(depth0,"__","CSV Options",options)))+'</h2>\n            <div class="grid-row">\n                <label class="col-5" for="field_delimiter">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},
helper?helper.call(depth0,"Field delimiter",options):helperMissing.call(depth0,"__","Field delimiter",options)))+'</label>\n                <input class="col-7" name="field_delimiter" id="field_delimiter" size="2" value=";" type="text">\n            </div>\n            <div class="grid-row">\n                <label class="col-5" for="field_encloser">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},
helper?helper.call(depth0,"Field encloser",options):helperMissing.call(depth0,"__","Field encloser",options)))+'</label>\n                <input class="col-7" name="field_encloser" size="2" value=\'"\' type="text">\n            </div>\n            <div class="grid-row">\n                <label class="col-5" for="multi_values_delimiter">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},
helper?helper.call(depth0,"Multiple values delimiter",options):helperMissing.call(depth0,"__","Multiple values delimiter",options)))+'</label>\n                <input class="col-7" name="multi_values_delimiter" size="2" value=\'|\' type="text">\n            </div>\n            <label class="grid-row">\n                <div class="col-5">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},
helper?helper.call(depth0,"First row column names",options):helperMissing.call(depth0,"__","First row column names",options)))+'</div>\n                <div class="col-7">\n                    <input type="checkbox" name="first_row_column_names" checked>\n                    <span class="icon-checkbox"></span>\n                </div>\n            </label>\n            <button type="submit" class="btn-success"><span class="icon-upload"></span>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},
helper?helper.call(depth0,"Export",options):helperMissing.call(depth0,"__","Export",options)))+"</button>\n        </div>\n    </form>\n</div>\n"})}),define("taoEventLog/components/export/exporter",["jquery","lodash","i18n","ui/component","ui/feedback","layout/loading-bar","tpl!taoEventLog/components/export/templates/layout","util/url","layout/logout-event","jquery.fileDownload"],function($,_,__,component,feedback,loadingBar,layoutTpl,url,logoutEvent){"use strict";return function(options){if(!_.isPlainObject(options)||!_.isString(options.exportUrl))throw new TypeError("The exporter must be configured with exportUrl option");return component({},{
title:__("Export")}).setTemplate(layoutTpl).on("render",function(){var self=this,$form=self.$component.find(".js-export-form");$form.on("submit",function(e){e.preventDefault(),loadingBar.start();var exportUrl,params={};_.each($form.serializeArray(),function(param){params[param.name]=param.value}),exportUrl=url.build(options.exportUrl,params),$.fileDownload(exportUrl,{successCallback:function(){loadingBar.stop(),self.$component.modal("close")},failCallback:function(jqXHR){loadingBar.stop();var response=$.parseJSON($(jqXHR).text());response?feedback().error(new Error(response.message)):(self.$component.modal("close"),logoutEvent())}})})}).init(options)}}),
define("taoEventLog/components/export/modalExporter",["jquery","lodash","i18n","ui/feedback","taoEventLog/components/export/exporter","ui/modal"],function($,_,__,feedback,exporter){"use strict";return function(options){var feedbackOptions={timeout:{warning:8e3},encodeHtml:!1};return exporter(options).on("warning",function(err){feedback().warning(err,feedbackOptions)}).on("error",function(err){feedback().error(err,feedbackOptions)}).on("render",function(){var self=this;this.$component.addClass("modal").on("close.modal",function(){self.$component.modal("close")}).modal({width:600})}).render("body")}}),
define("taoEventLog/controller/TaoEventLog/show",["jquery","i18n","helpers","ui/datatable","tpl!taoEventLog/controller/TaoEventLog/show/layout","taoEventLog/components/export/modalExporter","ui/dateRange"],function($,__,helpers,datatable,layoutTpl,exporter,dateRangeFactory){"use strict";var listUrl=helpers._url("search","TaoEventLog","taoEventLog");return{start:function(){var data={dataTypes:[{key:"event_name",title:__("Event Name")},{key:"action",title:__("Action")},{key:"user_id",title:__("User ID")},{key:"user_roles",title:__("User Roles")},{key:"occurred",title:__("Occurred")},{key:"properties",title:__("Properties")}]
},$layout=$(layoutTpl(data)),$eventFilter=$(".log-browser .log-table-filters",$layout),$eventList=$(".log-browser .log-table",$layout),$eventViewer=$(".event-viewer",$layout),$exportLink=$(".js-export",$layout),$filterRange=dateRangeFactory({pickerType:"datetimepicker",renderTo:$eventFilter,pickerConfig:{dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss"}}),updateEventDetails=function(event){var key,json,str;for(key in event)event.hasOwnProperty(key)&&("properties"===key?(json=JSON.parse(event[key]),null!==json&&"object"!=typeof json&&(json=JSON.parse(json)),str=JSON.stringify(json,void 0,2),
$("."+key,$eventViewer).html("<pre>"+str+"</pre>")):"user_roles"===key?$("."+key,$eventViewer).html(event.user_roles.split(",").join("<br>")):$("."+key,$eventViewer).html(event[key]))};$filterRange.on("submit",function(){$eventList.datatable("options",{params:{periodStart:$filterRange.getStart(),periodEnd:$filterRange.getEnd()}}),$eventList.datatable("refresh")}),$exportLink.on("click",function(){exporter({title:__("Export Log Entries"),exportUrl:helpers._url("export","TaoEventLog","taoEventLog")})}),$(".content").append($layout),$eventList.datatable({url:listUrl,sortby:"occurred",sortorder:"desc",filter:!0,rowSelection:!0,filterStrategy:"multiple",model:[{
id:"identifier",label:__("ID"),transform:function(id,row){return row.raw.id}},{id:"event_name",label:__("Event Name"),sortable:!0,filterable:!0},{id:"action",label:__("Action"),sortable:!0,filterable:!0},{id:"user_id",label:__("User ID"),sortable:!0,filterable:!0},{id:"user_roles",label:__("User Roles"),sortable:!0,filterable:!0,transform:function(roles){return roles.split(", ").shift()}},{id:"occurred",label:__("Occurred"),sortable:!0}],listeners:{selected:function(e,event){updateEventDetails(event.raw),$eventViewer.removeClass("hidden")},filter:function(e,options){options.page=1}}}).on("create.datatable",function(){$layout.trigger("dispatched")})}}});
//# sourceMappingURL=controllers.min.js.map