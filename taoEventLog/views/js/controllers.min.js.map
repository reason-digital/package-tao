{"version":3,"sources":["routes.js","TaoEventLog/show/layout!tpl","../components/export/templates/layout!tpl","../components/export/exporter.js","../components/export/modalExporter.js","TaoEventLog/show.js"],"names":["define","TaoEventLog","actions","index","hb","template","Handlebars","depth0","helpers","partials","data","program1","stack1","helper","buffer","title","call","hash","functionType","escapeExpression","key","this","compilerInfo","merge","options","helperMissing","self","__","each","dataTypes","inverse","noop","fn","program","$","_","component","feedback","loadingBar","layoutTpl","url","logoutEvent","isPlainObject","isString","exportUrl","TypeError","setTemplate","on","$form","$component","find","e","preventDefault","start","params","serializeArray","param","name","value","build","fileDownload","successCallback","stop","modal","failCallback","jqXHR","response","parseJSON","text","error","Error","message","init","exporter","feedbackOptions","timeout","warning","encodeHtml","err","addClass","width","render","datatable","dateRangeFactory","listUrl","_url","$layout","$eventFilter","$eventList","$eventViewer","$exportLink","$filterRange","pickerType","renderTo","pickerConfig","dateFormat","timeFormat","updateEventDetails","event","json","str","hasOwnProperty","JSON","parse","stringify","undefined","html","split","join","periodStart","getStart","periodEnd","getEnd","append","sortby","sortorder","filter","rowSelection","filterStrategy","model","id","label","transform","row","raw","sortable","filterable","roles","shift","listeners","selected","removeClass","page","trigger"],"mappings":"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","file":"routes.js","sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2016  (original work) Open Assessment Technologies SA;\n *\n * @author Alexander Zagovorichev <zagovorichev@1pt.com>\n */\n\ndefine('taoEventLog/controller/routes',[],function () {\n    'use strict';\n\n    return {\n        'TaoEventLog': {\n            'actions': {\n                'index': 'controller/TaoEventLog/show'\n            }\n        }\n    };\n});\n\n","\ndefine('tpl!taoEventLog/controller/TaoEventLog/show/layout', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing, self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\n                \\n                    <div class=\\\"grid-row\\\">\\n                        <div class=\\\"col-12\\\">\\n                            <strong>\";\n  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</strong>\\n                        </div>\\n                    </div>\\n                    <div class=\\\"grid-row\\\">\\n                        <div class=\\\"col-10 desc\\\">\\n                            <span class=\\\"\";\n  if (helper = helpers.key) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.key); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\"></span>\\n                        </div>\\n                    </div>\\n\\n                \";\n  return buffer;\n  }\n\n  buffer += \"<div class=\\\"log\\\">\\n    <div class=\\\"grid-row\\\">\\n        <div class=\\\"col-7\\\">\\n            <section class=\\\"log-browser\\\">\\n                <header>\\n                    <h2>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Log watcher\", options) : helperMissing.call(depth0, \"__\", \"Log watcher\", options)))\n    + \"</h2>\\n                    <div class=\\\"header-buttons\\\">\\n                        <button class=\\\"btn-info export js-export\\\"><span class=\\\"icon-export\\\"></span>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Export log entries\", options) : helperMissing.call(depth0, \"__\", \"Export log entries\", options)))\n    + \"</button>\\n                    </div>\\n                </header>\\n                <div class=\\\"log-table-filters\\\"></div>\\n                <div class=\\\"log-table\\\"></div>\\n            </section>\\n        </div>\\n        <div class=\\\"col-5\\\">\\n            <section class=\\\"event-viewer hidden\\\">\\n                <div class=\\\"grid-row\\\">\\n                    <div class=\\\"col-10\\\">\\n                        <h3>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Event\", options) : helperMissing.call(depth0, \"__\", \"Event\", options)))\n    + \" #<span class=\\\"id\\\"></span></h3>\\n                    </div>\\n                </div>\\n\\n                \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.dataTypes), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n\\n            </section>\\n        </div>\\n    </div>\\n</div>\\n\";\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoEventLog/components/export/templates/layout', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;\n\n\n  buffer += \"<div class=\\\"mp-export-modal\\\">\\n    <h1>\";\n  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</h1>\\n    <form class=\\\"grid-row js-export-form\\\">\\n        <div class=\\\"col-12\\\">\\n            <h2>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"CSV Options\", options) : helperMissing.call(depth0, \"__\", \"CSV Options\", options)))\n    + \"</h2>\\n            <div class=\\\"grid-row\\\">\\n                <label class=\\\"col-5\\\" for=\\\"field_delimiter\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Field delimiter\", options) : helperMissing.call(depth0, \"__\", \"Field delimiter\", options)))\n    + \"</label>\\n                <input class=\\\"col-7\\\" name=\\\"field_delimiter\\\" id=\\\"field_delimiter\\\" size=\\\"2\\\" value=\\\";\\\" type=\\\"text\\\">\\n            </div>\\n            <div class=\\\"grid-row\\\">\\n                <label class=\\\"col-5\\\" for=\\\"field_encloser\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Field encloser\", options) : helperMissing.call(depth0, \"__\", \"Field encloser\", options)))\n    + \"</label>\\n                <input class=\\\"col-7\\\" name=\\\"field_encloser\\\" size=\\\"2\\\" value='\\\"' type=\\\"text\\\">\\n            </div>\\n            <div class=\\\"grid-row\\\">\\n                <label class=\\\"col-5\\\" for=\\\"multi_values_delimiter\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Multiple values delimiter\", options) : helperMissing.call(depth0, \"__\", \"Multiple values delimiter\", options)))\n    + \"</label>\\n                <input class=\\\"col-7\\\" name=\\\"multi_values_delimiter\\\" size=\\\"2\\\" value='|' type=\\\"text\\\">\\n            </div>\\n            <label class=\\\"grid-row\\\">\\n                <div class=\\\"col-5\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"First row column names\", options) : helperMissing.call(depth0, \"__\", \"First row column names\", options)))\n    + \"</div>\\n                <div class=\\\"col-7\\\">\\n                    <input type=\\\"checkbox\\\" name=\\\"first_row_column_names\\\" checked>\\n                    <span class=\\\"icon-checkbox\\\"></span>\\n                </div>\\n            </label>\\n            <button type=\\\"submit\\\" class=\\\"btn-success\\\"><span class=\\\"icon-upload\\\"></span>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Export\", options) : helperMissing.call(depth0, \"__\", \"Export\", options)))\n    + \"</button>\\n        </div>\\n    </form>\\n</div>\\n\";\n  return buffer;\n  });\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2016  (original work) Open Assessment Technologies SA;\n *\n * @author Ivan Klimchuk <klimchuk@1pt.com>\n */\n\ndefine('taoEventLog/components/export/exporter',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'ui/component',\n    'ui/feedback',\n    'layout/loading-bar',\n    'tpl!taoEventLog/components/export/templates/layout',\n    'util/url',\n    'layout/logout-event',\n    'jquery.fileDownload'\n], function ($, _, __, component, feedback, loadingBar, layoutTpl, url, logoutEvent) {\n    'use strict';\n\n    /**\n     * @param {Object} options - the component configuration\n     * @returns {exporter} a new component\n     */\n    return function exporter(options) {\n        if (!_.isPlainObject(options) || !_.isString(options.exportUrl)) {\n            throw new TypeError('The exporter must be configured with exportUrl option');\n        }\n\n        return component({}, { title: __('Export') })\n            .setTemplate(layoutTpl)\n\n            // renders the component\n            .on('render', function () {\n                var self = this,\n                    $form = self.$component.find('.js-export-form');\n\n                $form.on('submit', function (e) {\n                    e.preventDefault();\n                    loadingBar.start();\n\n                    var params = {},\n                        exportUrl;\n\n                    _.each($form.serializeArray(), function(param){\n                        params[param.name] = param.value;\n                    });\n\n                    exportUrl = url.build(options.exportUrl, params);\n\n                    $.fileDownload(exportUrl, {\n                        successCallback : function () {\n                            loadingBar.stop();\n                            self.$component.modal('close');\n                        },\n                        failCallback : function (jqXHR) {\n                            loadingBar.stop();\n                            var response = $.parseJSON($(jqXHR).text());\n                            if (response) {\n                                feedback().error(new Error(response.message));\n                            } else {\n                                self.$component.modal('close');\n                                logoutEvent();\n                            }\n                        }\n                    });\n                });\n            })\n            .init(options);\n    }\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2016  (original work) Open Assessment Technologies SA;\n *\n * @author Ivan Klimchuk <klimchuk@1pt.com>\n */\n\ndefine('taoEventLog/components/export/modalExporter',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'ui/feedback',\n    'taoEventLog/components/export/exporter',\n    'ui/modal'\n], function ($, _, __, feedback, exporter) {\n    'use strict';\n\n    /**\n     * Wrap the exporter in a modal popup\n     *\n     * @param {Object} options - the exporter's configuration\n     * @param {String} exportUrl\n     */\n    return function modalExporter(options) {\n\n        var feedbackOptions = {\n            timeout: {\n                warning: 8000\n            },\n            encodeHtml: false\n        };\n\n        return exporter(options)\n            .on('warning', function (err) {\n                feedback().warning(err, feedbackOptions);\n            })\n            .on('error', function (err) {\n                feedback().error(err, feedbackOptions);\n            })\n            .on('render', function () {\n                var self = this;\n                this.$component\n                    .addClass('modal')\n                    .on('close.modal', function () {\n                        self.$component.modal('close');\n                    })\n                    .modal({ width: 600 });\n            })\n            .render('body');\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2016  (original work) Open Assessment Technologies SA;\n *\n * @author Alexander Zagovorichev <zagovorichev@1pt.com>\n */\n\ndefine('taoEventLog/controller/TaoEventLog/show',[\n    'jquery',\n    'i18n',\n    'helpers',\n    'ui/datatable',\n    'tpl!taoEventLog/controller/TaoEventLog/show/layout',\n    'taoEventLog/components/export/modalExporter',\n    'ui/dateRange'\n], function ($, __, helpers, datatable, layoutTpl, exporter, dateRangeFactory) {\n    'use strict';\n\n    //the endpoints\n    var listUrl = helpers._url('search', 'TaoEventLog', 'taoEventLog');\n\n    return {\n\n        /**\n         * Controller entry point\n         */\n        start: function start() {\n\n            var data = {\n                dataTypes: [\n                    {key: 'event_name', title: __('Event Name')},\n                    {key: 'action', title: __('Action')},\n                    {key: 'user_id', title: __('User ID')},\n                    {key: 'user_roles', title: __('User Roles')},\n                    {key: 'occurred', title: __('Occurred')},\n                    {key: 'properties', title: __('Properties')}\n                ]\n            };\n\n            var $layout = $(layoutTpl(data));\n            var $eventFilter = $('.log-browser .log-table-filters', $layout);\n            var $eventList = $('.log-browser .log-table', $layout);\n            var $eventViewer = $('.event-viewer', $layout);\n            var $exportLink = $('.js-export', $layout);\n\n            var $filterRange = dateRangeFactory({\n                pickerType: 'datetimepicker',\n                renderTo: $eventFilter,\n                pickerConfig: {\n                    // configurations from lib/jquery.timePicker.js\n                    dateFormat: 'yy-mm-dd',\n                    timeFormat: 'HH:mm:ss'\n                }\n            });\n\n            var updateEventDetails = function updateEventDetails(event) {\n                var key, json, str;\n                for (key in event) {\n                    if (event.hasOwnProperty(key)) {\n                        if (key === 'properties') {\n                            json = JSON.parse(event[key]);\n                            if (json !== null && typeof json !== 'object') {\n                                json = JSON.parse(json);\n                            }\n                            str = JSON.stringify(json, undefined, 2);\n                            $('.' + key, $eventViewer).html(\n                                '<pre>' + str + '</pre>'\n                            );\n                        } else if (key === 'user_roles') {\n                            $('.' + key, $eventViewer).html(event['user_roles'].split(',').join('<br>'));\n                        } else {\n                            $('.' + key, $eventViewer).html(event[key]);\n                        }\n                    }\n                }\n            };\n\n            $filterRange.on('submit', function() {\n\n                $eventList.datatable('options', {\n                    params: {\n                        periodStart: $filterRange.getStart(),\n                        periodEnd: $filterRange.getEnd()\n                    }\n                });\n\n                $eventList.datatable('refresh');\n            });\n\n            $exportLink.on('click', function () {\n                exporter({\n                    title: __('Export Log Entries'),\n                    exportUrl: helpers._url('export', 'TaoEventLog', 'taoEventLog')\n                });\n            });\n\n            //append the layout to the current view container\n            $('.content').append($layout);\n\n            //set up the student list\n            $eventList.datatable({\n                url: listUrl,\n                sortby: 'occurred',\n                sortorder: 'desc',\n                filter: true,\n                rowSelection: true,\n                filterStrategy: 'multiple',\n                model: [{\n                    id: 'identifier',\n                    label: __('ID'),\n                    transform: function (id, row) {\n                        return row.raw.id;\n                    }\n                }, {\n                    id: 'event_name',\n                    label: __('Event Name'),\n                    sortable: true,\n                    filterable: true\n                }, {\n                    id: 'action',\n                    label: __('Action'),\n                    sortable: true,\n                    filterable: true\n                }, {\n                    id: 'user_id',\n                    label: __('User ID'),\n                    sortable: true,\n                    filterable: true\n                }, {\n                    id: 'user_roles',\n                    label: __('User Roles'),\n                    sortable: true,\n                    filterable: true,\n                    transform: function (roles) {\n                        return roles.split(', ').shift();\n                    }\n                }, {\n                    id: 'occurred',\n                    label: __('Occurred'),\n                    sortable: true\n                }],\n\n                listeners: {\n                    /**\n                     * When a row is selected, we update the student viewer\n                     */\n                    selected: function selectRow(e, event) {\n                        updateEventDetails(event.raw);\n\n                        //the 1st time it comes hidden\n                        $eventViewer.removeClass('hidden');\n                    },\n\n                    /**\n                     * Set pagination to start position when using filtering\n                     * @param e\n                     * @param options\n                     */\n                    filter: function filtered(e, options) {\n                        options.page = 1;\n                    }\n\n                }\n            }).on('create.datatable', function () {\n                // the page is now ready\n                $layout.trigger('dispatched');\n            });\n        }\n    };\n});\n\n"]}